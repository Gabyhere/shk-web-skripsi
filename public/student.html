<!doctype html>
<html lang="id">
  <head>
    <meta charset="utf-8" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <title>Portal Siswa - SHK</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f5f7fa;
        display: flex;
        min-height: 100vh;
      }
      .sidebar {
        width: 280px;
        background: linear-gradient(180deg, #0d2bff, #0d2b52);
        color: white;
        position: fixed;
        height: 100vh;
        overflow-y: auto;
        z-index: 1000;
        display: flex;
        flex-direction: column;
      }
      .sidebar-menu {
        flex: 1;
        overflow-y: auto;
        padding: 20px 0;
      }
      .user-info {
        margin-top: auto;
        padding: 25px 20px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        background: rgba(0, 0, 0, 0.2);
      }
      .logo {
        padding: 30px 20px;
        text-align: center;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }
      .logo h1 {
        font-size: 3rem;
        font-weight: bold;
        margin-bottom: 10px;
        color: rgba(255, 255, 255, 0.9);
      }
      .menu-item {
        padding: 15px 25px;
        cursor: pointer;
        transition: all 0.3s ease;
        border-left: 4px solid transparent;
        display: flex;
        align-items: center;
        font-weight: 500;
        gap: 10px;
      }
      .menu-item:hover {
        background: rgba(255, 255, 255, 0.1);
        border-left-color: #fff;
      }
      .menu-item.active {
        background: rgba(255, 255, 255, 0.2);
        border-left-color: #fff;
      }
      .user-avatar {
        width: 40px;
        height: 40px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 15px;
      }
      .logout-btn {
        background: #ef4444;
        color: white;
        border: none;
        padding: 10px 16px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: background 0.3s;
        width: 100%;
        margin-top: 10px;
      }
      .logout-btn:hover {
        background: #dc2626;
      }
      .main-content {
        margin-left: 280px;
        flex: 1;
        padding: 20px;
        overflow-y: auto;
      }
      .content-body {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        min-height: 600px;
        overflow: hidden;
      }
      .school-hero {
        position: relative;
        height: 300px;
        background:
          linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3)), url('/uploads/gallery/1.jpeg');
        background-size: cover;
        background-position: center;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        text-align: center;
      }
      .content-section {
        padding: 30px;
      }
      .section-title {
        font-size: 1.5rem;
        color: #1f2937;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid #0d2bff;
        text-align: left;
      }
      .profile-card {
        background: #f8fafc;
        padding: 20px;
        border-radius: 10px;
        border-left: 4px solid #0d2bff;
        color: #64748b;
        text-align: left;
        margin-bottom: 20px;
      }
      .visi {
        text-align: left;
        font-size: 1.1rem;
        line-height: 1.6;
        color: #64748b;
        margin: 20px 0;
        padding: 25px;
        background: #f8fafc;
        border-radius: 10px;
        border-left: 4px solid #0d2bff;
      }
      .misi {
        text-align: left;
        font-size: 1.1rem;
        line-height: 1.6;
        color: #64748b;
        margin: 20px 0;
        padding: 25px;
        background: #f8fafc;
        border-radius: 10px;
        border-left: 4px solid #0d2bff;
      }
      .facilities-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }
      .facility-card {
        background: white;
        border: 1px solid #e2e8f0;
        border-radius: 10px;
        overflow: hidden;
        transition:
          transform 0.3s,
          box-shadow 0.3s;
        cursor: pointer;
      }
      .facility-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      }
      .facility-image {
        height: 150px;
        background-size: cover;
        background-position: center;
      }
      .teacher-card {
        transition:
          transform 0.3s ease,
          box-shadow 0.3s ease;
      }

      .teacher-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(13, 43, 255, 0.2);
      }
      .news-card {
        background: white;
        border: 1px solid #e2e8f0;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 25px;
        text-align: left;
      }
      .news-image {
        width: 100%;
        height: 220px;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        border-radius: 10px;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 3rem;
        object-fit: cover;
      }
      .news-title {
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 12px;
        color: #1f2937;
      }
      .pagination {
        display: flex;
        justify-content: center;
        gap: 12px;
        margin: 25px 0;
      }
      .pagination button {
        padding: 8px 16px;
        border: 1px solid #ddd;
        background: white;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 500;
      }
      .pagination button.active {
        background: #0d2bff;
        color: white;
      }
      .pengumuman-carousel {
        position: relative;
        overflow: hidden;
        padding: 20px 60px;
      }
      .pengumuman-container {
        display: flex;
        gap: 25px;
        transition: transform 0.3s ease;
      }
      .pengumuman-card {
        min-width: calc(33.333% - 17px);
        background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
        padding: 18px;
        border-radius: 12px;
        cursor: pointer;
      }
      .pengumuman-image {
        width: 100%;
        height: 190px;
        background-size: cover;
        background-position: center;
        border-radius: 10px;
        margin-bottom: 15px;
        background-color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 3rem;
      }
      .carousel-btn {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: #0d2bff;
        color: white;
        border: none;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 1.2rem;
        z-index: 10;
      }
      .carousel-btn.prev {
        left: 10px;
      }
      .carousel-btn.next {
        right: 10px;
      }
      .comment-section {
        margin-top: 30px;
        border-top: 2px solid #e2e8f0;
        padding-top: 20px;
      }
      .comment-item {
        background: #f8fafc;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
        border-left: 3px solid #0d2bff;
      }
      .comment-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
      }
      .comment-author {
        font-weight: 600;
        color: #1f2937;
      }
      .reply-section {
        margin-left: 30px;
        margin-top: 10px;
      }
      .reply-item {
        background: #e0e7ff;
        padding: 12px;
        border-radius: 8px;
        margin-bottom: 10px;
        border-left: 3px solid #6366f1;
      }
      .comment-form {
        display: flex;
        gap: 10px;
        margin-top: 15px;
      }
      .comment-input {
        flex: 1;
        padding: 10px;
        border: 2px solid #d1d5db;
        border-radius: 8px;
      }
      .comment-btn {
        padding: 10px 20px;
        background: #0d2bff;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
      }
      .schedule-table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
      }
      .schedule-table th {
        background: #0d2bff;
        color: white;
        padding: 12px;
        text-align: center;
      }
      .schedule-table td {
        padding: 12px;
        border: 1px solid #e2e8f0;
        text-align: center;
      }
      .calendar-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 25px;
      }
      .calendar-table th,
      .calendar-table td {
        border: 1px solid #e2e8f0;
        padding: 15px;
        text-align: center;
        vertical-align: top;
      }
      .calendar-table th {
        background: #f8fafc;
        font-weight: 600;
      }
      .calendar-table td {
        height: 80px;
      }
      .calendar-event {
        background: #fef3c7;
        color: #92400e;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.7rem;
        margin-top: 5px;
        display: block;
      }
      .calendar-controls {
        display: flex;
        gap: 12px;
        align-items: center;
        margin-bottom: 20px;
      }
      .calendar-controls button {
        padding: 6px 15px;
        background: #0d2bff;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
      }
      .page-footer {
        text-align: center;
        padding: 25px;
        background: #f8fafc;
        border-radius: 10px;
        margin-top: 40px;
        border-top: 2px solid #0d2bff;
      }
      .loading {
        text-align: center;
        padding: 40px;
        color: #64748b;
      }
      .error {
        background: #fef2f2;
        color: #dc2626;
        padding: 15px;
        border-radius: 8px;
        margin: 20px 0;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
      }
      table th {
        background: #0d2bff;
        color: white;
        padding: 14px;
        text-align: left;
      }
      table td {
        padding: 14px;
        border-bottom: 1px solid #e2e8f0;
      }

      .chatbot-container {
        position: fixed;
        bottom: 80px;
        right: 30px;
        width: 350px;
        height: 500px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
        display: none;
        flex-direction: column;
        z-index: 1000;
      }

      .chatbot-header {
        background: linear-gradient(135deg, #0d2bff, #0d2b52);
        color: white;
        padding: 15px;
        border-radius: 12px 12px 0 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .chatbot-messages {
        flex: 1;
        overflow-y: auto;
        padding: 15px;
        background: #f8fafc;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .chat-message {
        padding: 12px 16px;
        border-radius: 12px;
        max-width: 70%;
        word-wrap: break-word;
        animation: slideIn 0.3s ease;
      }

      .chat-message.user {
        background: #0d2bff;
        color: white;
        align-self: flex-end;
        border-bottom-right-radius: 4px;
      }

      .chat-message.bot {
        background: #e5e7eb;
        color: #1f2937;
        align-self: flex-start;
        border-bottom-left-radius: 4px;
      }

      .chat-message.guru {
        background: #3b82f6;
        color: white;
        align-self: flex-start;
        border-bottom-left-radius: 4px;
      }

      .chatbot-input {
        display: flex;
        padding: 15px;
        border-top: 1px solid #e2e8f0;
      }

      .chatbot-input input {
        flex: 1;
        padding: 10px;
        border: 2px solid #d1d5db;
        border-radius: 8px;
        margin-right: 10px;
      }

      .chatbot-toggle {
        position: fixed;
        bottom: 20px;
        right: 30px;
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, #0d2bff, #0d2b52);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        z-index: 999;
        transition: transform 0.3s;
      }

      .chatbot-toggle:hover {
        transform: scale(1.1);
      }

      @media (max-width: 1024px) {
        .sidebar {
          width: 250px;
        }
        .main-content {
          margin-left: 250px;
        }
        .facilities-grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      @media (max-width: 768px) {
        .sidebar {
          position: fixed;
          left: -280px;
          transition: left 0.3s ease;
          z-index: 2000;
        }

        .sidebar.open {
          left: 0;
        }

        .main-content {
          margin-left: 0;
          padding: 15px;
        }

        .school-hero {
          height: 200px;
        }

        .facilities-grid {
          grid-template-columns: 1fr;
        }

        .pengumuman-card {
          min-width: calc(100% - 20px);
        }

        .schedule-table,
        .calendar-table {
          font-size: 0.8rem;
        }

        .schedule-table th,
        .schedule-table td,
        .calendar-table th,
        .calendar-table td {
          padding: 6px;
        }

        .chatbot-container {
          width: 100%;
          height: 100vh;
          bottom: 0;
          right: 0;
          border-radius: 0;
        }

        .chatbot-toggle {
          bottom: 15px;
          right: 15px;
          width: 50px;
          height: 50px;
        }
      }

      @media (max-width: 480px) {
        .logo h1 {
          font-size: 2rem;
        }

        .section-title {
          font-size: 1.2rem;
        }

        .news-title {
          font-size: 1.1rem;
        }

        table th,
        table td {
          padding: 8px;
          font-size: 0.85rem;
        }
      }

      /* Mobile Menu Toggle */
      .mobile-menu-toggle {
        display: none;
        position: fixed;
        top: 15px;
        left: 15px;
        z-index: 2001;
        background: #0d2bff;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1.2rem;
      }

      @media (max-width: 768px) {
        .mobile-menu-toggle {
          display: block;
        }
      }

      .sidebar-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1999;
      }

      @media (max-width: 768px) {
        .sidebar-overlay.active {
          display: block;
        }
      }
    </style>
  </head>
  <body>
    <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">‚ò∞</button>
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleMobileMenu()"></div>
    <aside class="sidebar">
      <div class="logo"><h1>SHK</h1></div>
      <nav class="sidebar-menu">
        <div class="menu-item active" onclick="loadPage('profile')">
          <span>üìö</span><span>Profil Sekolah</span>
        </div>
        <div class="menu-item" onclick="loadPage('news')">
          <span>üì∞</span><span>Berita & Pengumuman</span>
        </div>
        <div class="menu-item" onclick="loadPage('gallery')">
          <span>üì∏</span><span>Galeri Foto Kegiatan</span>
        </div>
        <div class="menu-item" onclick="loadPage('schedule')">
          <span>üìÖ</span><span>Jadwal & Kalender</span>
        </div>
        <div class="menu-item" onclick="loadPage('grades')"><span>üìä</span><span>Nilai</span></div>
        <div class="menu-item" onclick="loadPage('report')"><span>üìã</span><span>Rapor</span></div>
      </nav>
      <div class="user-info">
        <div class="user-avatar">üë§</div>
        <div style="font-size: 0.9rem" id="userName">Siswa</div>
        <div style="font-size: 0.8rem; color: rgba(255, 255, 255, 0.7)" id="userClass">Kelas</div>
        <button class="logout-btn" onclick="logout()">Logout</button>
      </div>
    </aside>
    <main class="main-content"><div id="mainContent"></div></main>

    <script>
      const api = '/api';
      let user = JSON.parse(localStorage.getItem('user') || 'null');

      if (!user || !user.id || user.role !== 'siswa') {
        console.error('‚ùå Invalid user data:', user);
        alert('Silakan login sebagai siswa');
        window.location.href = '/index.html';
        throw new Error('Not authenticated'); // Stop execution
      }

      console.log('‚úÖ User loaded:', user);

      document.getElementById('userName').textContent = user.nama || 'Siswa';
      const kelasNames = {
        1: '1A',
        2: '1B',
        3: '1C',
        4: '2A',
        5: '2B',
        6: '2C',
        7: '3A',
        8: '3B',
        9: '3C',
        10: '4A',
        11: '4B',
        12: '4C',
        13: '5A',
        14: '5B',
        15: '5C',
        16: '6A',
        17: '6B',
        18: '6C',
      };
      const userKelas = kelasNames[user.kelasid] || user.kelas || '';
      document.getElementById('userClass').textContent = `Kelas ${userKelas}`;

      let currentNewsPage = 1,
        currentPengumumanIndex = 0,
        allPengumuman = [];
      const today = new Date();
      let currentCalendarMonth = today.getMonth(); // 0-11 (real-time)
      let currentCalendarYear = today.getFullYear();
      const itemsPerPage = 2;

      loadPage('profile');
      let chatInterval = null;

      // Ganti function toggleChatbot() yang lama dengan ini:
      function toggleChatbot() {
        const container = document.getElementById('chatbotContainer');
        const toggle = document.getElementById('chatbotToggle');

        const isVisible = getComputedStyle(container).display === 'flex';

        if (isVisible) {
          // TUTUP CHAT
          container.style.display = 'none';
          toggle.style.display = 'flex';

          // HENTIKAN INTERVAL
          if (chatInterval) {
            clearInterval(chatInterval);
            chatInterval = null;
          }
        } else {
          // BUKA CHAT
          container.style.display = 'flex';
          toggle.style.display = 'none';

          // Langsung load history (termasuk pesan default dari bot)
          loadChatHistory();

          if (!chatInterval) {
            chatInterval = setInterval(loadChatHistory, 3000);
          }
        }
      }

      async function loadChatHistory() {
        try {
          const res = await fetch(`${api}/chatbot/history/${user.id}`);
          if (res.ok) {
            const history = await res.json();
            const messagesDiv = document.getElementById('chatMessages');

            if (history.length === 0) {
              messagesDiv.innerHTML = `
          <div class="chat-message bot">
            <strong>ü§ñ Bot:</strong><br>
            Halo üëã Saya asisten virtual SD Hati Kudus.<br>
            Silakan tanyakan apa yang ingin kamu ketahui! üòä
          </div>
          <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; justify-content: flex-start;">
            <button onclick="sendQuickMessage('jadwal')" style="padding: 8px 16px; background: #3b82f6; color: white; border: none; border-radius: 20px; cursor: pointer; font-size: 0.85rem;">üìÖ Jadwal</button>
            <button onclick="sendQuickMessage('nilai')" style="padding: 8px 16px; background: #3b82f6; color: white; border: none; border-radius: 20px; cursor: pointer; font-size: 0.85rem;">üìä Nilai</button>
            <button onclick="sendQuickMessage('rapor')" style="padding: 8px 16px; background: #3b82f6; color: white; border: none; border-radius: 20px; cursor: pointer; font-size: 0.85rem;">üìã Rapor</button>
            <button onclick="sendQuickMessage('berita')" style="padding: 8px 16px; background: #3b82f6; color: white; border: none; border-radius: 20px; cursor: pointer; font-size: 0.85rem;">üì∞ Berita</button>
          </div>
        `;
              messagesDiv.scrollTop = messagesDiv.scrollHeight;
              return;
            }
            messagesDiv.innerHTML = '';

            history.forEach((chat) => {
              const messageDiv = document.createElement('div');
              messageDiv.className = 'chat-message';

              if (chat.guru_id) {
                // GURU - di kiri, hijau muda
                messageDiv.classList.add('guru');
                messageDiv.innerHTML = `<strong>üë®‚Äçüè´ ${chat.nama_guru || 'Guru'}:</strong><br>${chat.pesan}`;
              } else if (chat.user_id === user.id) {
                // USER (KITA) - di kanan, biru
                messageDiv.classList.add('user');
                // Hanya teks pesan saja, tidak perlu label
                messageDiv.textContent = chat.pesan;
              } else {
                // BOT - di kiri, abu-abu
                messageDiv.classList.add('bot');
                messageDiv.innerHTML = `<strong>ü§ñ Bot:</strong><br>${chat.pesan}`;
              }

              messagesDiv.appendChild(messageDiv);
            });

            messagesDiv.scrollTop = messagesDiv.scrollHeight;
          }
        } catch (error) {
          console.error('Load history error:', error);
        }
      }

      async function sendMessage() {
        const input = document.getElementById('chatInput');
        const message = input.value.trim();

        if (!message) return;

        // Tampilkan pesan user langsung (kanan, biru)
        const messagesDiv = document.getElementById('chatMessages');
        const userDiv = document.createElement('div');
        userDiv.className = 'chat-message user'; // class 'user' untuk biru di kanan
        userDiv.textContent = message; // Hanya teks, tanpa label
        messagesDiv.appendChild(userDiv);

        input.value = '';
        messagesDiv.scrollTop = messagesDiv.scrollHeight;

        try {
          const res = await fetch(`${api}/chatbot/message`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              siswa_id: user.id,
              message: message,
              is_from_siswa: true,
            }),
          });

          if (res.ok) {
            const data = await res.json();
            const botDiv = document.createElement('div');
            botDiv.className = 'chat-message bot'; // class 'bot' untuk abu-abu di kiri
            botDiv.innerHTML = `<strong>ü§ñ Bot:</strong><br>${data.response}`;
            messagesDiv.appendChild(botDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
          }
        } catch (error) {
          console.error('Chat error:', error);
          const errorDiv = document.createElement('div');
          errorDiv.className = 'chat-message bot';
          errorDiv.innerHTML =
            '<strong>ü§ñ Bot:</strong><br>‚ùå Maaf, terjadi kesalahan. Coba lagi ya!';
          messagesDiv.appendChild(errorDiv);
          messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
      }

      function sendQuickMessage(keyword) {
        const input = document.getElementById('chatInput');
        input.value = keyword;
        sendMessage();
      }

      function setActiveMenu(target) {
        document.querySelectorAll('.menu-item').forEach((i) => i.classList.remove('active'));
        if (target) target.classList.add('active');
      }

      function addFooter() {
        return `<div class="page-footer"><strong>Kontak:</strong> üì† info@hatikudus.com | Jl. Kavling Polri No.114-117, Jakarta Barat</div>`;
      }

      async function loadPage(page) {
        if (window.scheduleRefreshInterval) {
          clearInterval(window.scheduleRefreshInterval);
          window.scheduleRefreshInterval = null;
        }

        if (window.event?.target) setActiveMenu(window.event.target.closest('.menu-item'));
        const main = document.getElementById('mainContent');
        main.innerHTML = '<div class="loading">Loading...</div>';
        try {
          if (page === 'profile') await loadProfile(main);
          else if (page === 'news') await loadNews(main);
          else if (page === 'gallery') await loadGallery(main);
          else if (page === 'schedule') await loadSchedule(main);
          else if (page === 'grades') await loadGrades(main);
          else if (page === 'report') await loadReport(main);
        } catch (e) {
          console.error('Error:', e);
          main.innerHTML = `<div class="error">Error: ${e.message}</div>`;
        }
      }

      async function loadProfile(main) {
        let totalGuru = 19;
        try {
          const guruRes = await fetch(`${api}/teachers`);
          if (guruRes.ok) {
            const guruData = await guruRes.json();
            totalGuru = guruData.length || 19;
          }
        } catch (e) {
          console.log('Using default guru count');
        }
        main.innerHTML = `<div class="content-body">
        <div class="school-hero"><div><h2 style="font-size:2.5rem;">Sekolah SD Hati Kudus</h2><p style="font-size:1.1rem;">Sekolah Katolik di Jakarta Barat</p></div></div>
        <div class="content-section">
          <div class="section-title">Sejarah</div>
          <div class="profile-card"><p>SD Hati Kudus sudah ada sejak tahun 1980 yang didirikan dibawah Yayasan Pendidikan Dharma Jaya.</p></div>
          <div class="section-title">Visi</div>
          <div class="visi"><p>Fokus pada pembelajaran yang terus menerus sehingga dapat menghasilkan pribadi yang memiliki daya juang, bermoral, dan mampu berkontribusi kepada komunitas lokal dan global.</p></div>
          <div class="section-title">Misi</div>
          <div class="misi"><p>1. Untuk memberikan pengajaran, pembelajaran, dan penelitian dengan metode <i>active learning</i>.</p><br>
            <p>2. Menyelenggarakan proses belajar dan mengajar dengan penekanan pada inovasi ilmu pengetahuan.</p><br>
            <p>3. Mengembangkan pendidikan yang memberikan pengakuan dan penghargaan kepada talenta-talenta yang kreatif.</p><br>
            <p>4. Menghasilkan pemimpin yang memiliki daya juang sehingga mampu bersaing dalam masyarakat.</p><br>
            <p>5. Menyediakan pengalaman yang menambah nilai moral sehingga membentuk kepribadian yang utuh.</p><br>
            <p>6. Membangun masyarakat Jakarta khususnya dan bangsa Indonesia secara keseluruhan dengan menawarkan kontribusi terbaik yang dimiliki.</p>
            </div>
          <div class="section-title">Tenaga Pengajar</div>
      <div class="facilities-grid">
        <div class="facility-card"><div style="padding:15px;"><h5>Total Guru</h5><p style="font-size:2rem;font-weight:bold;color:#0d2bff;margin-top:10px;">28</p></div></div>
        <div class="facility-card"><div style="padding:15px;"><h5>Wali Kelas</h5><p style="font-size:2rem;font-weight:bold;color:#0d2bff;margin-top:10px;">18</p></div></div>
        <div class="facility-card"><div style="padding:15px;"><h5>Guru Komputer</h5><p style="font-size:2rem;font-weight:bold;color:#0d2bff;margin-top:10px;">1</p></div></div>
        <div class="facility-card"><div style="padding:15px;"><h5>Guru Agama</h5><p style="font-size:2rem;font-weight:bold;color:#0d2bff;margin-top:10px;">1</p></div></div>
        <div class="facility-card"><div style="padding:15px;"><h5>Guru B. Inggris</h5><p style="font-size:2rem;font-weight:bold;color:#0d2bff;margin-top:10px;">2</p></div></div>
        <div class="facility-card"><div style="padding:15px;"><h5>Guru B. Mandarin</h5><p style="font-size:2rem;font-weight:bold;color:#0d2bff;margin-top:10px;">2</p></div></div>
      </div>
      <div class="section-title" style="margin-top:50px;">Profil Guru</div>
      <div class="teacher-profiles" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:30px;margin-top:30px;">
        
        <div class="teacher-card" style="background:white;border-radius:15px;padding:25px;box-shadow:0 4px 15px rgba(0,0,0,0.1);text-align:center;">
          <h4 style="color:#0d2bff;margin-bottom:5px;">Suwandi, S.Pd.</h4>
          <p style="color:#666;font-size:0.95rem;margin-bottom:10px;">Kepala Sekolah SD Hati Kudus</p>
        </div>

        <div class="teacher-card" style="background:white;border-radius:15px;padding:25px;box-shadow:0 4px 15px rgba(0,0,0,0.1);text-align:center;">
          <img src="/uploads/profil guru/pak kur.jpeg" alt="Guru 1" style="width:150px;height:150px;border-radius:50%;object-fit:cover;margin:0 auto 20px;">
          <h4 style="color:#0d2bff;margin-bottom:5px;">Kurnianto, S.Pd.</h4>
          <p style="color:#666;font-size:0.95rem;margin-bottom:10px;">Administrasi SD Hati Kudus</p>
        </div>

        <div class="teacher-card" style="background:white;border-radius:15px;padding:25px;box-shadow:0 4px 15px rgba(0,0,0,0.1);text-align:center;">
          <img src="/uploads/profil guru/bu gita.jpeg" alt="Guru 2" style="width:150px;height:150px;border-radius:50%;object-fit:cover;margin:0 auto 20px;">
          <h4 style="color:#0d2bff;margin-bottom:5px;">Gita Ayissa, S.Pd.</h4>
          <p style="color:#666;font-size:0.95rem;margin-bottom:10px;">Guru PJOK</p>
        </div>

        <div class="teacher-card" style="background:white;border-radius:15px;padding:25px;box-shadow:0 4px 15px rgba(0,0,0,0.1);text-align:center;">
          <img src="/uploads/profil guru/pak kelvin.jpeg" alt="Guru 3" style="width:150px;height:150px;border-radius:50%;object-fit:cover;margin:0 auto 20px;">
          <h4 style="color:#0d2bff;margin-bottom:5px;">Marcellinus Kelvin, S.I.Kom.</h4>
          <p style="color:#666;font-size:0.95rem;margin-bottom:10px;">Guru Komputer</p>
        </div>

        <div class="teacher-card" style="background:white;border-radius:15px;padding:25px;box-shadow:0 4px 15px rgba(0,0,0,0.1);text-align:center;">
          <h4 style="color:#0d2bff;margin-bottom:5px;">Maria Sri Yayuk, S.Pd.</h4>
          <p style="color:#666;font-size:0.95rem;margin-bottom:10px;">Wali Kelas</p>
        </div>

        <div class="teacher-card" style="background:white;border-radius:15px;padding:25px;box-shadow:0 4px 15px rgba(0,0,0,0.1);text-align:center;">
          <h4 style="color:#0d2bff;margin-bottom:5px;">Budianto Hartono, S.Pd.</h4>
          <p style="color:#666;font-size:0.95rem;margin-bottom:10px;">Wali Kelas</p>
        </div>

        <div class="teacher-card" style="background:white;border-radius:15px;padding:25px;box-shadow:0 4px 15px rgba(0,0,0,0.1);text-align:center;">
          <h4 style="color:#0d2bff;margin-bottom:5px;">WahyuSusila, S.Pd.</h4>
          <p style="color:#666;font-size:0.95rem;margin-bottom:10px;">Wali Kelas</p>
        </div>

        <div class="teacher-card" style="background:white;border-radius:15px;padding:25px;box-shadow:0 4px 15px rgba(0,0,0,0.1);text-align:center;">
          <h4 style="color:#0d2bff;margin-bottom:5px;">Yohanes Edwin, S.Pd.</h4>
          <p style="color:#666;font-size:0.95rem;margin-bottom:10px;">Wali Kelas</p>
        </div>

        <div class="teacher-card" style="background:white;border-radius:15px;padding:25px;box-shadow:0 4px 15px rgba(0,0,0,0.1);text-align:center;">
          <h4 style="color:#0d2bff;margin-bottom:5px;">Veronica Yeni, S.Pd.</h4>
          <p style="color:#666;font-size:0.95rem;margin-bottom:10px;">Wali Kelas</p>
        </div>

        <div class="teacher-card" style="background:white;border-radius:15px;padding:25px;box-shadow:0 4px 15px rgba(0,0,0,0.1);text-align:center;">
          <h4 style="color:#0d2bff;margin-bottom:5px;">Mahmudin, S.Pd.</h4>
          <p style="color:#666;font-size:0.95rem;margin-bottom:10px;">Wali Kelas</p>
        </div>
        </div>
          <div class="section-title">Fasilitas</div>
          <div class="facilities-grid">
            <div class="facility-card"><div style="padding:15px;"><h5>Ruang Kelas</h5></div></div>
            <div class="facility-card"><div style="padding:15px;"><h5>Lab Komputer</h5></div></div>
            <div class="facility-card"><div style="padding:15px;"><h5>Perpustakaan</h5></div></div>
            <div class="facility-card"><div style="padding:15px;"><h5>Lapangan Olahraga</h5></div></div>
            <div class="facility-card"><div style="padding:15px;"><h5>Ruang UKS</h5></div></div>
            <div class="facility-card"><div style="padding:15px;"><h5>Lapangan Aula</h5></div></div>
          </div>
          ${addFooter()}
        </div>
      </div>`;
      }

      async function loadNews(main) {
        try {
          const res = await fetch(`${api}/news`);
          if (!res.ok) throw new Error('Gagal memuat berita');
          const allNews = await res.json();
          const berita = allNews.filter((i) => i.type === 'berita');
          const pengumuman = allNews.filter((i) => i.type === 'pengumuman');
          allPengumuman = pengumuman;

          const start = (currentNewsPage - 1) * itemsPerPage;
          const paged = berita.slice(start, start + itemsPerPage);
          const total = Math.ceil(berita.length / itemsPerPage);

          let newsHTML = '';
          for (const n of paged) {
            const cRes = await fetch(`${api}/comments/berita/${n.id}`);
            const comments = await cRes.json();
            const img = n.gambar?.startsWith('/uploads')
              ? `background-image:url('${n.gambar}');`
              : `background:linear-gradient(135deg,#667eea,#764ba2);`;
            newsHTML += `<div class="news-card">
            <div class="news-image" style="${img}">${n.gambar?.startsWith('/uploads') ? '' : n.gambar || 'üì∞'}</div>
            <div class="news-title">${n.judul}</div>
            <div style="color:#64748b;font-size:0.9rem;margin-bottom:10px;">üìÖ ${n.tanggal}</div>
            <p style="color:#64748b;line-height:1.6;">${n.konten}</p>
            <div class="comment-section"><h4>Komentar (${comments.length})</h4>
              <div>${renderComments(comments, n.id)}</div>
              <div class="comment-form">
                <input type="text" class="comment-input" id="cin-${n.id}" placeholder="Tulis komentar...">
                <button class="comment-btn" onclick="addComment(${n.id}, null)">Kirim</button>
              </div>
            </div>
          </div>`;
          }

          let pagHTML = '';
          for (let i = 1; i <= total; i++)
            pagHTML += `<button class="${i === currentNewsPage ? 'active' : ''}" onclick="changeNewsPage(${i})">${i}</button>`;

          const pengCards = pengumuman
            .map((a) => {
              const img = a.gambar?.startsWith('/uploads')
                ? `background-image:url('${a.gambar}');`
                : `color:#f59e0b;`;
              return `<div class="pengumuman-card" onclick="viewAnn(${a.id})">
            <div class="pengumuman-image" style="${img}">${a.gambar?.startsWith('/uploads') ? '' : a.gambar || 'üì¢'}</div>
            <h3>${a.judul}</h3><p style="margin-top:10px;color:#64748b;font-size:0.9rem;">${(a.pesan || a.konten || '').substring(0, 100)}...</p>
          </div>`;
            })
            .join('');

          main.innerHTML = `<div class="content-body"><div class="content-section">
          <div class="section-title">üì∞ Berita</div>${newsHTML}
          ${total > 1 ? `<div class="pagination">${pagHTML}</div>` : ''}
          <div class="section-title">üì¢ Pengumuman</div>
          <div class="pengumuman-carousel">
            <button class="carousel-btn prev" onclick="movePeng(-1)">&lt;</button>
            <div class="pengumuman-container" id="pengCont">${pengCards}</div>
            <button class="carousel-btn next" onclick="movePeng(1)">&gt;</button>
          </div>
          ${addFooter()}
        </div></div>`;
        } catch (e) {
          console.error('News error:', e);
          main.innerHTML = `<div class="error">Gagal memuat berita: ${e.message}</div>`;
        }
      }

      function renderComments(comments, bid) {
        if (!comments.length)
          return '<p style="color:#64748b;padding:20px;text-align:center;">Belum ada komentar</p>';
        return comments
          .map(
            (c) => `<div class="comment-item">
    <div class="comment-header">
      <span class="comment-author">${c.nama_siswa}</span>
      <div>
        <span style="color: #64748b;">${new Date(c.created_at).toLocaleString('id-ID')}</span>
        ${c.siswa_id === user.id ? `<button onclick="deleteComment(${c.id})" style="background:none;border:none;color:#ef4444;cursor:pointer;margin-left:10px;" title="Hapus komentar">√∞≈∏‚Äî‚Äò√Ø¬∏¬è</button>` : ''}
      </div>
    </div>
    <div>${c.komentar}</div>
    <button onclick="showReply(${c.id})" style="background:none;border:none;color:#0d2bff;cursor:pointer;margin-top:5px;">‚Ü™Ô∏è Balas</button>
    ${
      c.replies?.length
        ? `<div class="reply-section">${c.replies
            .map(
              (r) => `<div class="reply-item">
      <div class="comment-header">
        <span class="comment-author">${r.nama_siswa}</span>
        <div>
          <span style="color: #64748b;">${new Date(r.created_at).toLocaleString('id-ID')}</span>
          ${r.siswa_id === user.id ? `<button onclick="deleteComment(${r.id})" style="background:none;border:none;color:#ef4444;cursor:pointer;margin-left:10px;" title="Hapus balasan">√∞≈∏‚Äî‚Äò√Ø¬∏¬è</button>` : ''}
        </div>
      </div>
      <div>${r.komentar}</div></div>`
            )
            .join('')}</div>`
        : ''
    }
    <div id="rf-${c.id}" style="display:none;margin-top:10px;"><div class="comment-form">
      <input type="text" class="comment-input" id="ri-${c.id}" placeholder="Tulis balasan...">
      <button class="comment-btn" onclick="addComment(${bid},${c.id})">Kirim</button>
      <button class="comment-btn" style="background:#6b7280;" onclick="hideReply(${c.id})">Batal</button>
    </div></div>
  </div>`
          )
          .join('');
      }

      async function deleteComment(commentId) {
        if (!confirm('Hapus komentar ini?')) return;

        try {
          const res = await fetch(`${api}/comments/${commentId}`, {
            method: 'DELETE',
          });

          if (res.ok) {
            alert('Komentar berhasil dihapus');
            loadPage('news');
          } else {
            alert('Gagal menghapus komentar');
          }
        } catch (error) {
          console.error('Delete comment error:', error);
          alert('Terjadi kesalahan: ' + error.message);
        }
      }

      function showReply(cid) {
        document.getElementById(`rf-${cid}`).style.display = 'block';
      }
      function hideReply(cid) {
        document.getElementById(`rf-${cid}`).style.display = 'none';
      }

      async function addComment(bid, pid) {
        const inputId = pid ? `ri-${pid}` : `cin-${bid}`;
        const input = document.getElementById(inputId);
        const komentar = input.value.trim();
        if (!komentar) return alert('Komentar kosong');
        try {
          const res = await fetch(`${api}/comments`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ berita_id: bid, siswa_id: user.id, komentar, parent_id: pid }),
          });
          if (res.ok) {
            input.value = '';
            loadPage('news');
          } else alert('Gagal kirim');
        } catch (e) {
          alert('Error: ' + e.message);
        }
      }

      function movePeng(dir) {
        const cont = document.getElementById('pengCont');
        const cardW = cont.querySelector('.pengumuman-card').offsetWidth + 25;
        const maxScroll = (allPengumuman.length - 3) * cardW;
        currentPengumumanIndex += dir;
        if (currentPengumumanIndex < 0) currentPengumumanIndex = 0;
        if (currentPengumumanIndex * cardW > maxScroll)
          currentPengumumanIndex = Math.floor(maxScroll / cardW);
        cont.style.transform = `translateX(-${currentPengumumanIndex * cardW}px)`;
      }

      function viewAnn(id) {
        const a = allPengumuman.find((x) => x.id === id);
        if (a) alert(`${a.judul}\n\n${a.pesan || a.konten || ''}`);
      }

      // ADD this new function for gallery detail
      async function viewGalleryDetail(id) {
        try {
          const res = await fetch(`${api}/gallery`);
          const gallery = await res.json();
          const item = gallery.find((g) => g.id === id);

          if (!item) return;

          // Ambil deskripsi dari acara jika ada
          let deskripsi = item.deskripsi_acara || '';
          if (item.acara_id && !deskripsi) {
            try {
              const acaraRes = await fetch(`${api}/gallery/acara/${item.acara_id}`);
              if (acaraRes.ok) {
                const acara = await acaraRes.json();
                deskripsi = acara.deskripsi || '';
              }
            } catch (e) {
              console.log('Tidak dapat memuat deskripsi acara');
            }
          }

          const imgSrc = item.gambar_url?.startsWith('/uploads') ? item.gambar_url : '';

          const modalHTML = `
      <div style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:9999;display:flex;align-items:center;justify-content:center;" onclick="this.remove()">
        <div style="background:white;border-radius:12px;max-width:800px;width:90%;max-height:90vh;overflow-y:auto;position:relative;" onclick="event.stopPropagation()">
          <button onclick="this.closest('[style*=fixed]').remove()" style="position:absolute;top:15px;right:15px;background:white;border:none;font-size:2rem;cursor:pointer;width:40px;height:40px;border-radius:50%;box-shadow:0 2px 8px rgba(0,0,0,0.2);">&times;</button>
          ${imgSrc ? `<img src="${imgSrc}" style="width:100%;border-radius:12px 12px 0 0;max-height:500px;object-fit:cover;">` : `<div style="width:100%;height:300px;background:linear-gradient(45deg,#ff6b6b,#feca57);display:flex;align-items:center;justify-content:center;font-size:5rem;color:white;border-radius:12px 12px 0 0;">üì∏</div>`}
          <div style="padding:30px;">
            <h2 style="color:#0d2bff;margin-bottom:10px;">${item.judul}</h2>
            <p style="color:#64748b;margin-bottom:20px;">üìÖ ${item.tanggal}</p>
            ${deskripsi ? `<p style="color:#374151;line-height:1.6;">${deskripsi}</p>` : '<p style="color:#999;font-style:italic;">Tidak ada deskripsi</p>'}
          </div>
        </div>
      </div>
    `;

          document.body.insertAdjacentHTML('beforeend', modalHTML);
        } catch (e) {
          console.error('View gallery error:', e);
          alert('Gagal memuat detail galeri');
        }
      }

      function changeNewsPage(p) {
        currentNewsPage = p;
        loadPage('news');
      }

      async function loadGallery(main) {
        try {
          const res = await fetch(`${api}/gallery`);
          if (!res.ok) throw new Error('Gagal memuat galeri');
          const gallery = await res.json();
          const html = gallery
            .map((e) => {
              const img = e.gambar_url?.startsWith('/uploads')
                ? `background-image:url('${e.gambar_url}');`
                : `background:linear-gradient(45deg,#ff6b6b,#feca57);`;
              return `<div class="facility-card" onclick="viewGalleryDetail(${e.id})" style="cursor:pointer;">
          <div class="facility-image" style="${img}">${e.gambar_url?.startsWith('/uploads') ? '' : e.gambar_url || 'üì∑'}</div>
          <div style="padding:15px;">
            <h5>${e.judul}</h5>
            <p style="font-size:0.85rem;color:#64748b;margin-top:5px;">${e.tanggal}</p>
          </div>
        </div>`;
            })
            .join('');
          main.innerHTML = `<div class="content-body"><div class="content-section">
      <div class="section-title">üì∑ Galeri Foto Kegiatan</div>
      <div class="facilities-grid" style="grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));">${html || '<p style="padding:40px;color:#64748b;">Belum ada galeri</p>'}</div>
      ${addFooter()}
    </div></div>`;
        } catch (e) {
          console.error('Gallery error:', e);
          main.innerHTML = `<div class="error">Gagal memuat galeri: ${e.message}</div>`;
        }
      }

      async function loadSchedule(main) {
        try {
          const studentsRes = await fetch(`${api}/students`);
          const students = await studentsRes.json();

          const myData = students.find((s) => s.id === user.id);

          if (!myData || !myData.kelasid) {
            main.innerHTML = `<div class="content-body"><div class="content-section">
        <div class="section-title">Jadwal Pelajaran & Kalender</div>
        <p style="padding:40px;text-align:center;color:#64748b;">
          ‚ö†Ô∏è Data kelas Anda belum terdaftar.
        </p>
        ${addFooter()}
      </div></div>`;
            return;
          }

          const actualKelasId = myData.kelasid;
          const sRes = await fetch(`${api}/schedule/detail/${actualKelasId}`);

          // CEK RESPONSE OK DULU
          if (!sRes.ok) {
            main.innerHTML = `<div class="content-body"><div class="content-section">
    <div class="section-title">Jadwal Pelajaran & Kalender</div>
    <h3 style="margin-bottom:15px;">Jadwal Kelas ${myData.kelas}</h3>
    <p style="padding:40px;text-align:center;color:#64748b;">
      ‚ö†Ô∏è Gagal memuat jadwal. Silakan hubungi guru.
    </p>
    ${addFooter()}
  </div></div>`;
            return;
          }

          const scheduleDetail = await sRes.json();

          // CEK APAKAH ARRAY DAN ADA DATA
          if (!Array.isArray(scheduleDetail) || scheduleDetail.length === 0) {
            main.innerHTML = `<div class="content-body"><div class="content-section">
    <div class="section-title">Jadwal Pelajaran & Kalender</div>
    <h3 style="margin-bottom:15px;">Jadwal Kelas ${myData.kelas}</h3>
    <p style="padding:40px;text-align:center;color:#64748b;">
      ‚ö†Ô∏è Jadwal untuk kelas ini belum diatur oleh guru.
    </p>
    ${addFooter()}
  </div></div>`;
            return;
          }
          // Group by hari, 4 jam per hari
          const scheduleByDay = {
            Senin: [null, null, null, null],
            Selasa: [null, null, null, null],
            Rabu: [null, null, null, null],
            Kamis: [null, null, null, null],
            Jumat: [null, null, null, null],
          };

          scheduleDetail.forEach((item) => {
            if (scheduleByDay[item.hari] && item.jamke !== undefined && item.jamke < 4) {
              scheduleByDay[item.hari][item.jamke] = {
                pelajaran: item.namapelajaran,
                guru: item.nama_guru || '-',
                jam: item.jam || '-',
              };
            }
          });

          const jamLabels = ['07.00-08.45', '09.00-10.45', '11.00-12.00', '12.00-13.00'];

          let sHTML = `<table class="schedule-table">
      <thead>
        <tr>
          <th>Hari</th>
          ${jamLabels.map((j) => `<th>${j}</th>`).join('')}
        </tr>
      </thead>
      <tbody>`;

          ['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat'].forEach((hari) => {
            const schedule = scheduleByDay[hari];
            sHTML += `<tr><td><strong>${hari}</strong></td>`;

            schedule.forEach((item) => {
              if (item) {
                sHTML += `<td>${item.pelajaran}<br><small style="color: #666;">${item.guru}</small></td>`;
              } else {
                sHTML += `<td>-</td>`;
              }
            });

            sHTML += '</tr>';
          });

          sHTML += '</tbody></table>';

          const calHTML = generateCalendar();
          const months = [
            'Januari',
            'Februari',
            'Maret',
            'April',
            'Mei',
            'Juni',
            'Juli',
            'Agustus',
            'September',
            'Oktober',
            'November',
            'Desember',
          ];

          main.innerHTML = `<div class="content-body"><div class="content-section">
      <div class="section-title">Jadwal Pelajaran & Kalender</div>
      <h3 style="margin-bottom:15px;">Jadwal Kelas ${myData.kelas}</h3>
      <p style="color: #64748b; margin-bottom: 15px;">
        üè´ Sekolah: Jam 7 Pagi - 1 Siang | 
        üîî Istirahat 1: 08.45-09.00 | Istirahat 2: 10.45-11.00
      </p>
      ${sHTML}
      
      <div style="margin-top: 40px; padding: 20px; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 8px;">
        <strong>‚ÅâÔ∏è Butuh bantuan?</strong>
        <p style="margin-top: 10px;">Klik ikon chat di pojok kanan bawah!</p>
      </div>
      
      <h3 style="margin:40px 0 15px;">Kalender Kegiatan</h3>
      <div class="calendar-controls">
        <button onclick="prevMonth()">&lt;</button>
        <span>${months[currentCalendarMonth]} ${currentCalendarYear}</span>
        <button onclick="nextMonth()">&gt;</button>
      </div>
      ${calHTML}
      ${addFooter()}
    </div></div>`;
        } catch (e) {
          console.error('Schedule error:', e);
          main.innerHTML = `<div class="error">Gagal memuat jadwal: ${e.message}</div>`;
        }
      }

      function generateCalendar() {
        // Hari libur nasional dan kegiatan sekolah
        const events = {
          '2024-01-01': 'Tahun Baru 2024',
          '2024-02-10': 'Tahun Baru Imlek 2575',
          '2024-02-14': 'Hari Valentine',
          '2024-03-11': 'Isra Mikraj',
          '2024-03-29': 'Wafat Isa Al-Masih',
          '2024-03-31': 'Hari Paskah',
          '2024-04-10': 'Hari Raya Nyepi',
          '2024-05-01': 'Hari Buruh Internasional',
          '2024-05-09': 'Kenaikan Isa Al-Masih',
          '2024-05-23': 'Hari Raya Waisak',
          '2024-06-01': 'Hari Lahir Pancasila',
          '2024-06-17': 'Hari Raya Idul Fitri 1445 H',
          '2024-06-18': 'Hari Raya Idul Fitri 1445 H',
          '2024-07-07': 'Tahun Baru Islam 1446 H',
          '2024-08-17': 'Hari Kemerdekaan RI',
          '2024-09-16': 'Hari Raya Idul Adha 1445 H',
          '2024-12-25': 'Hari Raya Natal',
          '2024-12-26': 'Cuti Bersama Natal',
          '2025-01-01': 'Tahun Baru 2025',
          '2025-01-29': 'Tahun Baru Imlek 2576',
          '2025-02-14': 'Hari Valentine',
          '2025-03-01': 'Isra Mikraj',
          '2025-03-29': 'Hari Raya Nyepi',
          '2025-04-18': 'Wafat Isa Al-Masih',
          '2025-04-20': 'Hari Paskah',
          '2025-05-01': 'Hari Buruh Internasional',
          '2025-05-29': 'Kenaikan Isa Al-Masih',
          '2025-05-31': 'Hari Raya Waisak',
          '2025-06-01': 'Hari Lahir Pancasila',
          '2025-06-07': 'Hari Raya Idul Fitri 1446 H',
          '2025-06-08': 'Hari Raya Idul Fitri 1446 H',
          '2025-06-27': 'Tahun Baru Islam 1447 H',
          '2025-08-17': 'Hari Kemerdekaan RI',
          '2025-09-05': 'Hari Raya Idul Adha 1446 H',
          '2025-12-25': 'Hari Raya Natal',
          '2025-12-26': 'Cuti Bersama Natal',
          '2026-01-01': 'Tahun Baru 2026',
          '2026-02-14': 'Hari Valentine',
          '2026-02-17': 'Tahun Baru Imlek 2577',
          '2026-02-18': 'Isra Mikraj',
          '2026-03-19': 'Hari Raya Nyepi',
          '2026-04-03': 'Wafat Isa Al-Masih',
          '2026-04-05': 'Hari Paskah',
          '2026-05-01': 'Hari Buruh Internasional',
          '2026-05-14': 'Kenaikan Isa Al-Masih',
          '2026-05-20': 'Hari Raya Waisak',
          '2026-06-01': 'Hari Lahir Pancasila',
          '2026-05-27': 'Hari Raya Idul Fitri 1447 H',
          '2026-05-28': 'Hari Raya Idul Fitri 1447 H',
          '2026-07-17': 'Tahun Baru Islam 1448 H',
          '2026-08-17': 'Hari Kemerdekaan RI',
          '2026-08-26': 'Hari Raya Idul Adha 1447 H',
          '2026-12-25': 'Hari Raya Natal',
          '2026-12-26': 'Cuti Bersama Natal',
        };

        const firstDay = new Date(currentCalendarYear, currentCalendarMonth, 1).getDay();
        const daysInMonth = new Date(currentCalendarYear, currentCalendarMonth + 1, 0).getDate();
        let html = `<table class="calendar-table"><tr><th>Senin</th><th>Selasa</th><th>Rabu</th><th>Kamis</th><th>Jumat</th></tr>`;
        let date = 1;
        for (let i = 0; i < 6; i++) {
          html += '<tr>';
          for (let j = 0; j < 5; j++) {
            if (i === 0 && j < firstDay - 1) html += '<td></td>';
            else if (date > daysInMonth) html += '<td></td>';
            else {
              const key = `${currentCalendarYear}-${String(currentCalendarMonth + 1).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
              const evt = events[key];
              let eHTML = evt ? `<div class="calendar-event">${evt}</div>` : '';
              html += `<td><strong>${date}</strong>${eHTML}</td>`;
              date++;
            }
          }
          html += '</tr>';
          if (date > daysInMonth) break;
        }
        return html + '</table>';
      }

      function prevMonth() {
        if (currentCalendarMonth === 0) {
          currentCalendarMonth = 11;
          currentCalendarYear--;
        } else currentCalendarMonth--;
        loadPage('schedule');
      }
      function nextMonth() {
        if (currentCalendarMonth === 11) {
          currentCalendarMonth = 0;
          currentCalendarYear++;
        } else currentCalendarMonth++;
        loadPage('schedule');
      }

      // Di function loadGrades
      async function loadGrades(main) {
        try {
          // √¢≈ì‚Ä¶ Ambil semua nilai individual
          const res = await fetch(`${api}/report/nilai-individual`);
          if (!res.ok) throw new Error('Gagal memuat nilai');

          let allNilai = await res.json();

          console.log('üìù ALL NILAI from API:', allNilai);
          console.log('üë§ Current User ID:', user.id);

          // √¢≈ì‚Ä¶ Filter: HANYA untuk siswa ini DAN nilai yang BUKAN rapor
          const nilaiManual = allNilai.filter((n) => {
            const isMySiswa = n.siswa_id === user.id;
            // Nilai manual = yang TIDAK punya format uh1:|uh2:|uts:|uas:
            const isNotRapor =
              !n.keterangan ||
              (!n.keterangan.includes('uh1:') &&
                !n.keterangan.includes('uh2:') &&
                !n.keterangan.includes('uts:') &&
                !n.keterangan.includes('uas:'));

            console.log('Nilai check:', {
              id: n.id,
              nama: n.nama_pelajaran,
              siswa_id: n.siswa_id,
              user_id: user.id,
              keterangan: n.keterangan,
              isMySiswa,
              isNotRapor,
              PASS: isMySiswa && isNotRapor,
            });

            return isMySiswa && isNotRapor;
          });

          console.log('üìä Total nilai manual untuk user ini:', nilaiManual.length);
          console.log('üìä Nilai manual yang akan ditampilkan:', nilaiManual);

          if (nilaiManual.length === 0) {
            main.innerHTML = `<div class="content-body"><div class="content-section">
        <div class="section-title">üìä Nilai Saya</div>
        <p style="background: #fef3c7; padding: 15px; border-radius: 8px; color: #92400e; margin-bottom: 20px;">
          üìä Nilai ini adalah nilai <strong>tugas</strong> yang diinput oleh guru.<br>
          Untuk melihat nilai rapor lengkap (UH1, UH2, UTS, UAS), silakan buka menu <strong>"Rapor"</strong>.
        </p>
        <p style="text-align:center;padding:40px;color:#64748b;">Belum ada nilai tugas</p>
        ${addFooter()}
      </div></div>`;
            return;
          }

          let tHTML = `<table><thead><tr><th>Mata Pelajaran</th><th>Nilai</th><th>Semester</th><th>Tahun Ajaran</th></tr></thead><tbody>`;

          nilaiManual.forEach((n) => {
            tHTML += `<tr>
        <td>${n.nama_pelajaran}</td>
        <td><strong style="font-size: 1.2rem; color: #0d2bff;">${n.nilai}</strong></td>
        <td>Semester ${n.semester}</td>
        <td>${n.tahun_ajaran}</td>
      </tr>`;
          });

          tHTML += '</tbody></table>';

          main.innerHTML = `<div class="content-body"><div class="content-section">
      <div class="section-title">üìä Nilai Saya</div>
      <p style="background: #fef3c7; padding: 15px; border-radius: 8px; color: #92400e; margin-bottom: 20px;">
       üìä Nilai ini adalah nilai <strong>tugas</strong> yang diinput langsung oleh guru.<br>
        Untuk melihat nilai rapor lengkap (UH1, UH2, UTS, UAS), silakan buka menu <strong>"Rapor"</strong>.
      </p>
      ${tHTML}${addFooter()}
    </div></div>`;
        } catch (e) {
          console.error('Grades error:', e);
          main.innerHTML = `<div class="error">Gagal memuat nilai: ${e.message}</div>`;
        }
      }

      async function loadReport(main) {
        try {
          const [raporRes, nilaiRes] = await Promise.all([
            fetch(`${api}/report/rapor/${user.id}`),
            fetch(`${api}/report/nilai/${user.id}`),
          ]);

          if (!raporRes.ok) throw new Error('Gagal memuat rapor');

          const rapor = await raporRes.json();
          const allNilai = await nilaiRes.json();

          console.log('üìä All Nilai:', allNilai);

          if (!rapor.length) {
            main.innerHTML = `
        <div class="content-body">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <div class="section-title" style="margin: 0;">üìã Rapor</div>
            <button onclick="printRaporPDF()" style="padding: 10px 20px; background: #0d2bff; color: white; border: none; border-radius: 8px; cursor: pointer;">
              üìÇ Download PDF
            </button>
          </div>
            <p style="text-align:center;padding:40px;color:#64748b;">Belum ada data rapor</p>
            ${addFooter()}
          </div>
        </div>
      `;
            return;
          }

          const rHTML = rapor
            .map((r) => {
              const nilaiSemester = allNilai.filter((n) => {
                const matchSemester = n.semester == r.semester;
                const matchTA = n.tahun_ajaran === r.tahun_ajaran;

                const hasValidKeterangan =
                  n.keterangan &&
                  n.keterangan !== 'manual_input' &&
                  (n.keterangan.includes('uh1:') ||
                    n.keterangan.includes('uh2:') ||
                    n.keterangan.includes('uh3:') ||
                    n.keterangan.includes('uh4:') ||
                    n.keterangan.includes('uts:') ||
                    n.keterangan.includes('uas:'));

                return matchSemester && matchTA && hasValidKeterangan;
              });

              console.log(`‚ÑπÔ∏è Semester ${r.semester} - Nilai rapor:`, nilaiSemester.length);

              let nilaiHTML = '';
              if (nilaiSemester.length > 0) {
                nilaiHTML = `
  <div style="overflow-x: auto;">
    <table style="margin: 15px 0; width: 100%; min-width: 800px;">
      <thead>
        <tr>
          <th>Mata Pelajaran</th>
          <th>UH1</th>
          <th>UH2</th>
          <th>UH3</th>
          <th>UH4</th>
          <th>UTS</th>
          <th>UAS</th>
          <th>Rata-rata</th>
        </tr>
      </thead>
      <tbody>
        ${nilaiSemester
          .map((n) => {
            let uh1 = '-',
              uh2 = '-',
              uh3 = '-',
              uh4 = '-',
              uts = '-',
              uas = '-';

            if (n.keterangan) {
              const parts = n.keterangan.split('|');
              parts.forEach((part) => {
                if (part.startsWith('uh1:')) uh1 = part.split(':')[1] || '-';
                if (part.startsWith('uh2:')) uh2 = part.split(':')[1] || '-';
                if (part.startsWith('uh3:')) uh3 = part.split(':')[1] || '-';
                if (part.startsWith('uh4:')) uh4 = part.split(':')[1] || '-';
                if (part.startsWith('uts:')) uts = part.split(':')[1] || '-';
                if (part.startsWith('uas:')) uas = part.split(':')[1] || '-';
              });
            }

            return `
              <tr>
                <td>${n.nama_pelajaran}</td>
                <td style="text-align: center;">${uh1}</td>
                <td style="text-align: center;">${uh2}</td>
                <td style="text-align: center;">${uh3}</td>
                <td style="text-align: center;">${uh4}</td>
                <td style="text-align: center;">${uts}</td>
                <td style="text-align: center;">${uas}</td>
                <td style="text-align: center;"><strong style="color: #0d2bff;">${n.nilai}</strong></td>
              </tr>
            `;
          })
          .join('')}
      </tbody>
    </table>
  </div>
`;
              } else {
                nilaiHTML =
                  '<p style="color: #666; padding: 20px; background: #f8fafc; border-radius: 8px; text-align: center;">Belum ada nilai rapor untuk semester ini</p>';
              }

              const komentarStyle =
                r.komentar && r.komentar.includes('[TIDAK_NAIK]')
                  ? 'text-decoration: line-through; color: #ef4444;'
                  : '';

              const komentarText = r.komentar
                ? r.komentar.replace('[TIDAK_NAIK]', '')
                : '<em style="color: #999;">Belum ada komentar</em>';

              return `
          <div style="background:white;border:1px solid #e2e8f0;border-radius:12px;padding:25px;margin-bottom:25px;">
            <h3 style="color:#0d2bff;">Semester ${r.semester} - Tahun Ajaran ${r.tahun_ajaran}</h3>
            
            ${nilaiHTML}
            
            <div style="background:#f8fafc;padding:15px;border-radius:8px;margin-top:20px;">
              <strong>Komentar Wali Kelas:</strong>
              <p style="margin-top:10px;color:#64748b;line-height: 1.6; ${komentarStyle}">${komentarText}</p>
            </div>
          </div>
        `;
            })
            .join('');

          main.innerHTML = `
      <div class="content-body">
        <div class="content-section">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <div class="section-title" style="margin: 0;">üìã Rapor</div>
            <button onclick="printRaporPDF()" style="padding: 10px 20px; background: #0d2bff; color: white; border: none; border-radius: 8px; cursor: pointer;">
              üìÇ Download PDF
            </button>
          </div>
          ${rHTML}
          ${addFooter()}
        </div>
      </div>
    `;
        } catch (e) {
          console.error('Report error:', e);
          main.innerHTML = `<div class="error">Gagal memuat rapor: ${e.message}</div>`;
        }
      }

      async function printRaporPDF() {
        if (typeof window.jspdf === 'undefined') {
          alert('‚ö†Ô∏è Library PDF belum siap. Silakan refresh halaman.');
          return;
        }

        try {
          const [nilaiRes, raporRes, siswaRes] = await Promise.all([
            fetch(`${api}/report/nilai/${user.id}`),
            fetch(`${api}/report/rapor/${user.id}`),
            fetch(`${api}/students/${user.id}`),
          ]);

          const allNilai = await nilaiRes.json();
          const rapor = await raporRes.json();
          const siswaData = await siswaRes.json();

          if (rapor.length === 0) {
            alert('Belum ada data rapor');
            return;
          }

          const { jsPDF } = window.jspdf;
          const doc = new jsPDF();

          // Mapping kelas
          const kelasNames = {
            1: '1A',
            2: '1B',
            3: '1C',
            4: '2A',
            5: '2B',
            6: '2C',
            7: '3A',
            8: '3B',
            9: '3C',
            10: '4A',
            11: '4B',
            12: '4C',
            13: '5A',
            14: '5B',
            15: '5C',
            16: '6A',
            17: '6B',
            18: '6C',
          };
          const userKelas = kelasNames[user.kelasid] || user.kelas || siswaData.kelas || '';
          const namaSiswa = siswaData.nama || user.nama;

          // ===== LOOP UNTUK SETIAP SEMESTER (TIDAK ADA COVER PAGE) =====
          rapor.forEach((r, pageIndex) => {
            if (pageIndex > 0) {
              doc.addPage();
            }

            // ===== HEADER DENGAN BORDER BIRU =====
            // Judul "RAPOR SISWA" (Biru, Bold, Besar)
            doc.setTextColor(13, 43, 255);
            doc.setFontSize(24);
            doc.setFont(undefined, 'bold');
            doc.text('RAPOR SISWA', 105, 30, { align: 'center' });

            // Nama Sekolah (Hitam, Bold)
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(16);
            doc.text('SD HATI KUDUS', 105, 42, { align: 'center' });

            // Alamat Sekolah (Hitam, Normal, Lebih kecil)
            doc.setFont(undefined, 'normal');
            doc.setFontSize(10);
            doc.text('Jl. Kavling Polri No.114-117, Jakarta Barat', 105, 50, { align: 'center' });

            // Tahun Ajaran dan Semester
            doc.setFontSize(11);
            doc.text(`Tahun Ajaran ${r.tahun_ajaran} - Semester ${r.semester}`, 105, 58, {
              align: 'center',
            });

            // Garis pemisah horizontal biru
            doc.setDrawColor(13, 43, 255);
            doc.setLineWidth(0.5);
            doc.line(20, 63, 190, 63);

            // ===== MULAI TRACKING UNTUK BORDER BIRU PENUH =====
            const borderStartY = 15;
            const borderX = 15;
            const borderWidth = 180;

            // ===== INFO SISWA (2 KOLOM) =====
            doc.setFontSize(11);
            doc.setFont(undefined, 'normal');

            // Kolom kiri
            doc.setFont(undefined, 'bold');
            doc.text('Nama Siswa', 25, 73);
            doc.text('Semester', 25, 85);

            doc.setFont(undefined, 'normal');
            doc.text(`: ${namaSiswa}`, 60, 73);
            doc.text(`: ${r.semester}`, 60, 85);

            // Kolom kanan
            doc.setFont(undefined, 'bold');
            doc.text('Kelas', 120, 73);
            doc.text('Tahun Ajaran', 120, 85);

            doc.setFont(undefined, 'normal');
            doc.text(`: ${userKelas}`, 155, 73);
            doc.text(`: ${r.tahun_ajaran}`, 155, 85);

            // ===== BAGIAN A. NILAI AKADEMIK =====
            let currentY = 115;

            doc.setFontSize(12);
            doc.setFont(undefined, 'bold');
            doc.setTextColor(13, 43, 255);
            doc.text('A. Nilai Akademik', 20, currentY);

            currentY += 8;

            // Filter nilai rapor
            const nilaiSem = allNilai.filter((n) => {
              const matchSem = n.semester == r.semester;
              const matchTA = n.tahun_ajaran === r.tahun_ajaran;
              const hasKeterangan =
                n.keterangan &&
                n.keterangan !== 'manual_input' &&
                (n.keterangan.includes('uh1:') ||
                  n.keterangan.includes('uh2:') ||
                  n.keterangan.includes('uh3:') ||
                  n.keterangan.includes('uh4:') ||
                  n.keterangan.includes('uts:') ||
                  n.keterangan.includes('uas:'));

              return matchSem && matchTA && hasKeterangan;
            });

            const pdfHeaders = [
              ['No', 'Mata Pelajaran', 'UH1', 'UH2', 'UH3', 'UH4', 'UTS', 'UAS', 'Rata-rata'],
            ];
            const pdfBody = [];

            nilaiSem.forEach((n, idx) => {
              let uh1 = '-',
                uh2 = '-',
                uh3 = '-',
                uh4 = '-',
                uts = '-',
                uas = '-';

              if (n.keterangan) {
                const parts = n.keterangan.split('|');
                parts.forEach((part) => {
                  const [key, val] = part.split(':');
                  if (key === 'uh1') uh1 = val || '-';
                  if (key === 'uh2') uh2 = val || '-';
                  if (key === 'uh3') uh3 = val || '-';
                  if (key === 'uh4') uh4 = val || '-';
                  if (key === 'uts') uts = val || '-';
                  if (key === 'uas') uas = val || '-';
                });
              }

              pdfBody.push([idx + 1, n.nama_pelajaran, uh1, uh2, uh3, uh4, uts, uas, n.nilai]);
            });

            if (pdfBody.length === 0) {
              doc.setTextColor(0, 0, 0);
              doc.setFontSize(10);
              doc.setFont(undefined, 'normal');
              doc.text('Belum ada nilai untuk semester ini', 20, currentY);
              currentY += 15;
            } else {
              doc.autoTable({
                startY: currentY,
                head: pdfHeaders,
                body: pdfBody,
                styles: {
                  fontSize: 9,
                  cellPadding: 3,
                  lineColor: [200, 200, 200],
                  lineWidth: 0.1,
                },
                headStyles: {
                  fillColor: [13, 43, 255],
                  textColor: [255, 255, 255],
                  fontStyle: 'bold',
                  halign: 'center',
                },
                columnStyles: {
                  0: { cellWidth: 10, halign: 'center' },
                  1: { cellWidth: 50 },
                  2: { cellWidth: 14, halign: 'center' },
                  3: { cellWidth: 14, halign: 'center' },
                  4: { cellWidth: 14, halign: 'center' },
                  5: { cellWidth: 14, halign: 'center' },
                  6: { cellWidth: 14, halign: 'center' },
                  7: { cellWidth: 14, halign: 'center' },
                  8: { cellWidth: 20, halign: 'center', fontStyle: 'bold' },
                },
                margin: { left: 20, right: 20 },
              });
              currentY = doc.lastAutoTable.finalY + 10;
            }

            // ===== BAGIAN B. CATATAN WALI KELAS =====
            doc.setFontSize(12);
            doc.setFont(undefined, 'bold');
            doc.setTextColor(13, 43, 255);
            doc.text('B. Catatan Wali Kelas', 20, currentY);

            currentY += 7;
            doc.setTextColor(0, 0, 0);
            doc.setFont(undefined, 'normal');
            doc.setFontSize(10);
            const cleanKomentar = r.komentar
              ? r.komentar.replace('[TIDAK_NAIK]', '').trim()
              : 'Belum ada komentar';
            const splitKomentar = doc.splitTextToSize(cleanKomentar, 170);
            doc.text(splitKomentar, 20, currentY);

            currentY += splitKomentar.length * 5 + 10;

            // ===== BAGIAN C. STATUS KENAIKAN KELAS (SEMESTER 2 SAJA) =====
            if (r.semester == 2) {
              const statusNaik = r.komentar && !r.komentar.includes('[TIDAK_NAIK]');

              doc.setFontSize(12);
              doc.setFont(undefined, 'bold');
              doc.setTextColor(13, 43, 255);
              doc.text('C. Status Kenaikan Kelas', 20, currentY);

              currentY += 7;

              // Box status dengan warna
              doc.setFillColor(
                statusNaik ? 209 : 254,
                statusNaik ? 250 : 226,
                statusNaik ? 229 : 226
              );
              doc.roundedRect(20, currentY, 170, 15, 2, 2, 'F');

              doc.setFontSize(12);
              doc.setFont(undefined, 'bold');
              doc.setTextColor(statusNaik ? 6 : 153, statusNaik ? 95 : 27, statusNaik ? 70 : 27);
              doc.text(statusNaik ? 'NAIK KELAS' : 'TIDAK NAIK KELAS', 105, currentY + 10, {
                align: 'center',
              });

              currentY += 22;
            }

            // ===== TANDA TANGAN =====
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            doc.setTextColor(0, 0, 0);

            const tanggalCetak = new Date().toLocaleDateString('id-ID', {
              day: 'numeric',
              month: 'long',
              year: 'numeric',
            });

            doc.text(`Jakarta, ${tanggalCetak}`, 20, currentY);
            currentY += 10;

            // Kolom tanda tangan
            doc.text('Orang Tua/Wali,', 40, currentY);
            doc.text('Wali Kelas,', 140, currentY);

            currentY += 25;

            // Garis tanda tangan
            doc.line(30, currentY, 80, currentY);
            doc.line(130, currentY, 180, currentY);

            currentY += 5;

            doc.text('(..............................)', 40, currentY);
            doc.text('(..............................)', 140, currentY);

            // ===== GAMBAR BORDER BIRU PENUH DI AKHIR =====
            const borderHeight = currentY + 10 - borderStartY;
            doc.setDrawColor(13, 43, 255);
            doc.setLineWidth(0.8);
            doc.rect(borderX, borderStartY, borderWidth, borderHeight);
          });

          // ===== SAVE PDF =====
          doc.save(`Rapor-${namaSiswa}-${new Date().toISOString().split('T')[0]}.pdf`);
        } catch (err) {
          console.error('Error generating PDF:', err);
          alert('‚ùå Terjadi kesalahan saat generate PDF: ' + err.message);
        }
      }

      function appendMessage(text, type) {
        const messagesDiv = document.getElementById('chatMessages');
        const messageDiv = document.createElement('div');
        messageDiv.className = `chat-message ${type}`;
        messageDiv.textContent = text;
        messagesDiv.appendChild(messageDiv);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
      }

      function logout() {
        localStorage.removeItem('user');
        alert('Logout berhasil');
        window.location.href = '/index.html';
      }

      function toggleMobileMenu() {
        const sidebar = document.getElementById('studentSidebar');
        const overlay = document.getElementById('sidebarOverlay');
        sidebar.classList.toggle('open');
        overlay.classList.toggle('active');
      }
    </script>

    <!-- Chatbot Container -->
    <div class="chatbot-container" id="chatbotContainer">
      <div class="chatbot-header">
        <div>
          <strong>üí¨ Chat dengan Bot</strong>
          <div style="font-size: 0.8rem; opacity: 0.9">Tanya tentang jadwal, nilai, pengumuman</div>
        </div>
        <div style="display: flex; gap: 10px">
          <button
            onclick="toggleChatbot()"
            style="background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer"
          >
            &times;
          </button>
        </div>
      </div>
      <div class="chatbot-messages" id="chatMessages">
        <div class="chat-message bot">
          Halo! Saya chatbot SD Hati Kudus. Ada yang bisa saya bantu?
        </div>
      </div>
      <div class="chatbot-input">
        <input
          type="text"
          id="chatInput"
          placeholder="Ketik pesan..."
          onkeypress="if(event.key==='Enter') sendMessage()"
        />
        <button
          onclick="sendMessage()"
          style="
            padding: 10px 20px;
            background: #0d2bff;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
          "
        >
          Kirim
        </button>
      </div>
    </div>

    <!-- Chatbot Toggle Button -->
    <div class="chatbot-toggle" id="chatbotToggle" onclick="toggleChatbot()">
      <span style="font-size: 2rem">üí¨</span>
    </div>
  </body>
</html>
